#! /usr/bin/env python
# -*- coding: utf-8 -*-

__author__ = 'chinfeng'

from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from sqlalchemy.pool import NullPool

import sys

Base = declarative_base()

if 'bae' in sys.modules:
    from bae.core import const
    engine = create_engine(
        'mysql://%s:%s@%s:%s/NtwLDxlnbZIsMEPsgrFH' % (
        const.MYSQL_USER, const.MYSQL_PASS, const.MYSQL_HOST, const.MYSQL_PORT),
        echo=False, encoding='utf-8', poolclass=NullPool)
elif 'sae' in sys.modules:
    from sae import const
    engine = create_engine(
        'mysql://%s:%s@%s:%s/%s' % (
        const.MYSQL_USER, const.MYSQL_PASS, const.MYSQL_HOST, const.MYSQL_PORT, const.MYSQL_DB),
        echo=False, encoding='utf-8', poolclass=NullPool)
else:
    import sqlalchemy.engine.url
    import sqlite3
    url = sqlalchemy.engine.url.URL('sqlite', database=r'd:\weicbd_db.sqlite3')
    engine = create_engine(sqlalchemy.engine.url.make_url(url), connect_args={'detect_types': sqlite3.PARSE_DECLTYPES|sqlite3.PARSE_COLNAMES, 'isolation_level': 'DEFERRED'},
                native_datetime=True, encoding='utf-8', poolclass=sqlalchemy.pool.NullPool)

# 测试用
#from sqlalchemy import event, DDL
#event.listen(
    #Base.metadata,
    #"before_create",
    #DDL('DROP TABLE weicbd_weixin_mp')
#)
# 以上结束测试代码

import model

def getSession():
    Session = sessionmaker(bind=engine)
    return Session()

